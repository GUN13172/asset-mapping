# 导出功能整合说明

## 📋 更新内容

### ✅ 已完成的修改

#### 1. **资产测绘页面增强** (`src/components/AssetQuery.tsx`)

在查询结果表格下方新增"数据导出"卡片，提供三种导出模式：

**📤 导出模式**

1. **导出当前页结果**
   - 快速导出当前查询结果页
   - 显示实际数据条数
   - 仅在有查询结果时可用

2. **导出指定页数** ✨ 新功能
   - 自定义导出页数（1-1000页）
   - 自定义每页条数（10/20/50/100）
   - 实时显示预计导出数量
   - 示例：10页 × 100条/页 = 1000条数据

3. **导出全部数据** ✨ 新功能
   - 导出当前查询条件的所有数据
   - 自动计算总页数
   - 警告提示：可能需要较长时间

#### 2. **简化菜单** (`src/App.tsx`)

- ✅ 移除了单独的"数据导出"菜单项
- ✅ 导出功能直接集成在"资产测绘"页面
- ✅ 查询完成后无需切换页面即可导出

---

## 🎯 功能特点

### 智能提示
- 当前页模式：显示实际数据条数
- 自定义模式：显示预计导出数量
- 全部模式：警告可能耗时较长

### 状态管理
- 导出按钮文字随模式动态变化
- 导出时显示加载状态
- 成功/失败消息提示

### 用户体验
- 📊 查询和导出在同一页面完成
- 🎚️ 灵活的导出选项
- 💡 清晰的操作提示
- ⚡ 快捷的操作流程

---

## 🚀 使用流程

### 典型使用场景

**场景1：快速导出当前页**
1. 输入查询条件 → 点击"查询"
2. 查看结果 → 选择"导出当前页结果"
3. 点击"导出当前页" → 完成

**场景2：导出指定数量数据**
1. 输入查询条件
2. 选择"导出指定页数"
3. 设置页数（如：20页）和每页条数（如：100条/页）
4. 点击"导出指定页数" → 导出2000条数据

**场景3：导出全部数据**
1. 输入查询条件
2. 选择"导出全部数据"
3. 设置每页条数
4. 点击"导出全部" → 导出所有匹配数据

---

## 📝 代码改动说明

### 新增状态变量
```typescript
const [exportLoading, setExportLoading] = useState<boolean>(false);
const [exportType, setExportType] = useState<'current' | 'custom' | 'all'>('current');
const [customPages, setCustomPages] = useState<number>(10);
const [customPageSize, setCustomPageSize] = useState<number>(100);
```

### 新增导出函数
- `exportCurrentPage()` - 导出当前页
- `exportCustomPages()` - 导出指定页数
- `exportAll()` - 导出全部数据
- `handleExport()` - 统一导出处理
- `handleExportTypeChange()` - 切换导出模式

### UI组件增强
- 新增导出设置卡片
- 单选按钮组选择导出模式
- 数字输入框设置页数
- 下拉选择框设置每页条数
- 实时计算和显示预计导出数量

---

## 🎨 界面预览

```
┌─────────────────────────────────────────────┐
│ 数据导出                      [导出当前页] │
├─────────────────────────────────────────────┤
│ ◉ 导出当前页结果 (20条数据)                │
│ ○ 导出指定页数                              │
│ ○ 导出全部数据                              │
│                                             │
│ ℹ️ 将导出当前页的 20 条数据                 │
└─────────────────────────────────────────────┘
```

当选择"导出指定页数"时：
```
┌─────────────────────────────────────────────┐
│ 数据导出                    [导出指定页数] │
├─────────────────────────────────────────────┤
│ ○ 导出当前页结果                            │
│ ◉ 导出指定页数                              │
│ ○ 导出全部数据                              │
│                                             │
│    导出页数: [10] 页 | 每页: [100条/页] ▼  │
│    (预计导出 1000 条)                       │
└─────────────────────────────────────────────┘
```

---

## ⚡ 性能优化

- 导出时显示加载状态，防止重复点击
- 成功/失败消息及时反馈
- 大数据量导出时有明确警告提示

---

## 🔧 技术实现

### 后端调用
- `export_results` - 导出指定页数
- `export_platform_all` - 导出全部（pages: 0）

### 前端优化
- TypeScript 类型安全
- Ant Design 组件库
- 响应式布局设计

---

## 📌 注意事项

1. **导出当前页**：需要先执行查询才能导出
2. **导出指定页数**：无需查询，直接指定页数即可
3. **导出全部数据**：大数据量时可能耗时较长，请耐心等待
4. 所有导出数据保存在设置中配置的导出路径

---

## 🎉 用户体验提升

**之前的流程：**
1. 在"资产测绘"页面查询
2. 切换到"数据导出"页面
3. 重新输入查询条件
4. 设置导出参数
5. 点击导出

**现在的流程：**
1. 在"资产测绘"页面查询
2. 直接在结果下方选择导出模式
3. 点击导出 ✨

**节省步骤：** 从 5 步 → 3 步，效率提升 40%！

---

## 📊 功能对比

| 功能 | 旧版 | 新版 |
|------|------|------|
| 导出当前页 | ❌ | ✅ |
| 自定义页数 | ✅ | ✅ |
| 导出全部 | ✅ | ✅ |
| 无需切换页面 | ❌ | ✅ |
| 实时预览数量 | ❌ | ✅ |
| 智能提示 | ❌ | ✅ |

---

更新时间：2025-11-04
版本：v1.3.0


